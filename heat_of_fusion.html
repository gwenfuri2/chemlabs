<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Heat of Fusion Lab</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .lab-stage { display: none; margin-top: 20px; }
    .lab-stage.active { display: block; }
    .controls, .lab-section { text-align: center; margin-top: 20px; }
    #calorimeter {
      width: 120px; height: 200px; margin: 20px auto;
      position: relative; background: #ddd;
      border: 4px solid #888; border-radius: 8px; overflow: hidden;
    }
    #ice, #water {
      position: absolute; bottom: 0; width: 100%;
      transition: height 1s ease;
    }
    #ice { height: 30px; background: #ccf; bottom: 90px; }
    #water { height: 90px; background: #add8e6; }
    #thermometer {
      margin: 10px auto; width: 10px; height: 100px;
      background: #eee; border: 2px solid #aaa; border-radius: 5px;
      position: relative;
    }
    #mercury {
      position: absolute; bottom: 0; width: 100%;
      background: red; height: 0%;
      transition: height 1s ease;
    }
    .summary-box, .explanation-box {
      background: #f9fbff; border: 1px solid #c0d0f0;
      padding: 15px; border-radius: 8px; margin: 20px auto; max-width: 600px;
    }
    input, select {
      padding: 6px; margin: 4px; font-size: 1rem;
      width: 100%; max-width: 200px;
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">üè† Home</a>
    <a href="titration.html">Titration</a>
    <a href="freezing_point.html">Freezing Point</a>
    <a href="heat_of_fusion.html" style="text-decoration: underline;">Heat of Fusion</a>
    <a href="reaction_rates.html">Reaction Rates</a>
  </nav>

  <h1>Heat of Fusion Step-by-Step Simulator</h1>

  <div id="step1" class="lab-stage active">
    <div class="lab-section">
      <h3>Step 1: Enter Your Lab Values</h3>
      <label>Temperature Unit:
        <select id="tempUnit">
          <option value="C">¬∞C</option>
          <option value="K">Kelvin</option>
        </select>
      </label><br>
      <label>Mass Unit:
        <select id="massUnit">
          <option value="g">grams</option>
          <option value="kg">kilograms</option>
        </select>
      </label><br>
      <label>Mass of warm water: <input type="number" id="massWater" value="50" /></label><br>
      <label>Initial temperature of water: <input type="number" id="tempInitial" value="70" /></label><br>
      <label>Final temperature after mixing: <input type="number" id="tempFinal" value="1" /></label><br>
      <label>Mass of melted ice: <input type="number" id="massIce" value="30" /></label>
    </div>
  </div>

  <div id="step2" class="lab-stage">
    <h3>Step 2: Warming water to input temp</h3>
    <div id="thermometer"><div id="mercury" style="height: 70%;"></div></div>
  </div>

  <div id="step3" class="lab-stage">
    <h3>Step 3: Ice added to calorimeter</h3>
    <div id="calorimeter">
      <div id="ice"></div>
      <div id="water"></div>
    </div>
  </div>

  <div id="step4" class="lab-stage">
    <h3>Step 4: Water poured in ‚Äî temp drops</h3>
    <div id="thermometer"><div id="mercury" style="height: 1%;"></div></div>
    <p>Simulating energy transfer...</p>
  </div>

  <div id="step5" class="lab-stage">
    <h3>Step 5: Calculate heat of fusion</h3>
    <button onclick="calculate()">Calculate & Explain</button>
  </div>

  <div id="step6" class="lab-stage">
    <div class="summary-box">
      <h3>Results Summary</h3>
      <p><strong>Heat lost by water:</strong> <span id="qWater">‚Äî</span> kJ</p>
      <p><strong>Heat of fusion:</strong>
        <span id="heatFusion">‚Äî</span> kJ/g |
        <span id="heatFusionKG">‚Äî</span> kJ/kg
      </p>
      <p><strong>Molar heat of fusion:</strong> <span id="molarFusion">‚Äî</span> kJ/mol</p>
    </div>
    <div class="explanation-box">
      <h3>Explanation</h3>
      <p id="explanation">‚Äî</p>
    </div>
  </div>

  <div class="controls">
    <button id="nextBtn" onclick="nextStep()">Next Step</button>
    <button onclick="resetSim()">Reset</button>
  </div>

  <script>
    const specificHeat = 4.184;
    const molarMassIce = 18.02;
    let currentStep = 1;

    function convertTemp(val, unit) {
      return unit === "K" ? val - 273.15 : val;
    }

    function convertMass(val, unit) {
      return unit === "kg" ? val * 1000 : val;
    }

    function nextStep() {
      document.getElementById(`step${currentStep}`).classList.remove("active");
      currentStep++;
      document.getElementById(`step${currentStep}`).classList.add("active");

      if (currentStep === 3) {
        document.getElementById("ice").style.height = "30px";
        document.getElementById("water").style.height = "90px";
      }

      if (currentStep === 4) {
        document.getElementById("ice").style.height = "0px";
        document.getElementById("water").style.height = "120px";
        document.querySelectorAll("#thermometer #mercury").forEach(el => {
          el.style.height = "1%";
        });
      }

      if (currentStep === 6) {
        document.getElementById("nextBtn").style.display = "none";
      }
    }

    function resetSim() {
      document.querySelectorAll(".lab-stage").forEach(el => el.classList.remove("active"));
      document.getElementById("step1").classList.add("active");
      document.getElementById("ice").style.height = "30px";
      document.getElementById("water").style.height = "90px";
      document.getElementById("nextBtn").style.display = "inline-block";
      currentStep = 1;
    }

    function calculate() {
      const tempUnit = document.getElementById("tempUnit").value;
      const massUnit = document.getElementById("massUnit").value;
      const mWaterRaw = parseFloat(document.getElementById("massWater").value);
      const mIceRaw = parseFloat(document.getElementById("massIce").value);
      const tInitialRaw = parseFloat(document.getElementById("tempInitial").value);
      const tFinalRaw = parseFloat(document.getElementById("tempFinal").value);

      if (isNaN(mWaterRaw) || isNaN(mIceRaw) || isNaN(tInitialRaw) || isNaN(tFinalRaw)) {
        alert("Please enter valid numeric values.");
        return;
      }

      const mWater = convertMass(mWaterRaw, massUnit);
      const mIce = convertMass(mIceRaw, massUnit);
      const tInitial = convertTemp(tInitialRaw, tempUnit);
      const tFinal = convertTemp(tFinalRaw, tempUnit);
      const deltaT = tInitial - tFinal;

      const qWaterJ = mWater * specificHeat * deltaT;
      const qWaterKJ = qWaterJ / 1000;
      const heatFusionPerGram = qWaterKJ / mIce;
      const heatFusionPerKg = heatFusionPerGram * 1000;
      const molarFusion = heatFusionPerGram * molarMassIce;

      document.getElementById("qWater").textContent = qWaterKJ.toFixed(2);
      document.getElementById("heatFusion").textContent = heatFusionPerGram.toFixed(3);
      document.getElementById("heatFusionKG").textContent = heatFusionPerKg.toFixed(2);
      document.getElementById("molarFusion").textContent = molarFusion.toFixed(2);

      document.getElementById("explanation").innerHTML = `
        You entered a water mass of <strong>${mWaterRaw} ${massUnit}</strong> and ice mass of <strong>${mIceRaw} ${massUnit}</strong>.
        The water started at <strong>${tInitialRaw}¬∞${tempUnit}</strong> and cooled to <strong>${tFinalRaw}¬∞${tempUnit}</strong>.
        <br><br>
        Using <strong>q = mcŒîT</strong>:
        <br>
        q = ${mWater}g √ó 4.184 J/g¬∞C √ó (${deltaT.toFixed(1)}¬∞C) = ${qWaterJ.toFixed(2)} J = ${qWaterKJ.toFixed(2)} kJ
        <br><br>
        Assuming all this energy melted the ice:
        <br>
        q / m_ice = ${qWaterKJ.toFixed(2)} kJ / ${mIce}g = <strong>${heatFusionPerGram.toFixed(3)} kJ/g</strong>
        <br><br>
        Molar heat of fusion: ${heatFusionPerGram.toFixed(3)} √ó 18.02 = <strong>${molarFusion.toFixed(2)} kJ/mol</strong>.
      `;

      nextStep();
    }
  </script>
</body>
</html>
